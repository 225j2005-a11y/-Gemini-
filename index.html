<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="apple-touch-icon.v3.png">
    <link rel="manifest" href="manifest.json">
    <title>时光宝盒</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f8fafc; padding-top: env(safe-area-inset-top); }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
    </style>
</head>
<body class="min-h-screen pb-20">
    <!-- 顶部导航 -->
    <header class="sticky top-0 z-50 p-4 glass-card shadow-sm">
        <div class="flex justify-between items-center max-w-2xl mx-auto">
            <h1 class="text-xl font-bold text-indigo-600">时光宝盒 ✨</h1>
            <div class="flex gap-3">
                <!-- 导出按钮：带有导出图标 -->
                <button onclick="exportData()" class="bg-slate-100 text-slate-500 w-10 h-10 rounded-2xl flex items-center justify-center active:scale-95 transition">
                    <i class="fas fa-file-export"></i>
                </button>
                <button onclick="document.getElementById('modal').classList.remove('hidden')" class="bg-indigo-600 text-white w-10 h-10 rounded-2xl flex items-center justify-center shadow-lg active:scale-95 transition">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-2xl mx-auto px-4 mt-4">
        <div id="notesContainer" class="space-y-4"></div>
    </main>

    <!-- 添加笔记弹窗 -->
    <div id="modal" class="fixed inset-0 bg-black/40 hidden z-[100] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-6 shadow-2xl">
            <h2 class="text-xl font-bold mb-4">记录此刻</h2>
            <input type="text" id="t" placeholder="标题" class="w-full p-4 mb-3 bg-slate-50 rounded-2xl outline-none">
            <textarea id="c" rows="5" placeholder="此刻的想法..." class="w-full p-4 mb-4 bg-slate-50 rounded-2xl outline-none"></textarea>
            <div class="flex gap-2">
                <button onclick="document.getElementById('modal').classList.add('hidden')" class="flex-1 py-4 bg-slate-100 rounded-2xl font-bold text-slate-400">取消</button>
                <button onclick="saveNote()" class="flex-1 py-4 bg-indigo-600 rounded-2xl font-bold text-white">保存</button>
            </div>
        </div>
    </div>

    <!-- 备份弹窗 -->
    <div id="exModal" class="fixed inset-0 bg-black/40 hidden z-[110] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-6">
            <h2 class="text-xl font-bold mb-2">备份数据</h2>
            <p class="text-xs text-slate-400 mb-4">全选复制下方内容保存即可</p>
            <textarea id="exArea" readonly class="w-full p-4 mb-4 bg-slate-50 rounded-2xl outline-none text-[10px] font-mono h-40"></textarea>
            <button onclick="document.getElementById('exModal').classList.add('hidden')" class="w-full py-4 bg-indigo-600 rounded-2xl font-bold text-white">完成</button>
        </div>
    </div>

    <script>
        const KEY = 'jia_notes_v4';
        let notes = JSON.parse(localStorage.getItem(KEY) || '[]');

        function render() {
            const container = document.getElementById('notesContainer');
            container.innerHTML = notes.length ? notes.map(n => `
                <div class="glass-card p-6 rounded-[2rem] shadow-sm relative border-l-4 border-indigo-500">
                    <div class="flex justify-between text-[10px] text-slate-400 mb-2">
                        <span>${n.date}</span>
                        <button onclick="del(${n.id})" class="text-slate-300"><i class="far fa-trash-alt"></i></button>
                    </div>
                    <h3 class="font-bold mb-1">${n.title}</h3>
                    <p class="text-sm text-slate-600 whitespace-pre-wrap">${n.content}</p>
                </div>
            `).join('') : '<p class="text-center py-20 text-slate-300">还没有记录</p>';
        }

        function saveNote() {
            const title = document.getElementById('t').value || '碎碎念';
            const content = document.getElementById('c').value;
            if(!content) return;
            notes.unshift({ id: Date.now(), title, content, date: new Date().toLocaleDateString() });
            localStorage.setItem(KEY, JSON.stringify(notes));
            document.getElementById('t').value = ''; document.getElementById('c').value = '';
            document.getElementById('modal').classList.add('hidden');
            render();
        }

        function del(id) { if(confirm('删除吗？')) { notes = notes.filter(n => n.id !== id); localStorage.setItem(KEY, JSON.stringify(notes)); render(); } }

        function exportData() {
            document.getElementById('exArea').value = JSON.stringify(notes, null, 2);
            document.getElementById('exModal').classList.remove('hidden');
        }

        render();
    </script>
</body>
</html>
